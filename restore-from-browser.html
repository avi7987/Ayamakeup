<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×©×—×–×•×¨ × ×ª×•× ×™× ××”×“×¤×“×¤×Ÿ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #9333ea;
            text-align: center;
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            background: #f9fafb;
            border-radius: 8px;
        }
        .data-box {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
            direction: ltr;
            text-align: left;
        }
        button {
            background: #9333ea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            margin-top: 10px;
        }
        button:hover {
            background: #7e22ce;
        }
        .success {
            background: #10b981;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            display: none;
        }
        .error {
            background: #ef4444;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .instructions {
            background: #dbeafe;
            padding: 15px;
            border-radius: 8px;
            border-right: 4px solid #3b82f6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ ×©×—×–×•×¨ × ×ª×•× ×™× ××”×“×¤×“×¤×Ÿ</h1>
        
        <div class="instructions">
            <h3>×”×•×¨××•×ª:</h3>
            <ol>
                <li>×¤×ª×— ××ª ×”×“×£ ×”×–×” <strong>×‘××•×ª×• ×“×¤×“×¤×Ÿ</strong> ×©×‘×• ×”×©×ª××©×ª ×‘××¢×¨×›×ª</li>
                <li>×œ×—×¥ ×¢×œ ×”×›×¤×ª×•×¨ "×—×¤×© × ×ª×•× ×™× ×‘×“×¤×“×¤×Ÿ"</li>
                <li>×× × ××¦××• × ×ª×•× ×™× - ×”×¢×ª×§ ××•×ª× ×•×”×“×‘×§ ×‘×§×•×‘×¥ db.json</li>
            </ol>
        </div>

        <div class="section">
            <h3>×©×œ×‘ 1: ×—×™×¤×•×© × ×ª×•× ×™× ×‘×“×¤×“×¤×Ÿ</h3>
            <button onclick="searchLocalStorage()">ğŸ” ×—×¤×© × ×ª×•× ×™× ×‘×“×¤×“×¤×Ÿ</button>
            <div id="result"></div>
        </div>

        <div class="section" id="clients-section" style="display:none;">
            <h3>×”×›× ×¡×•×ª (Clients)</h3>
            <div class="data-box" id="clients-data"></div>
            <button onclick="copyClients()">ğŸ“‹ ×”×¢×ª×§ × ×ª×•× ×™ ×”×›× ×¡×•×ª</button>
        </div>

        <div class="section" id="leads-section" style="display:none;">
            <h3>×œ×™×“×™× (Leads)</h3>
            <div class="data-box" id="leads-data"></div>
            <button onclick="copyLeads()">ğŸ“‹ ×”×¢×ª×§ × ×ª×•× ×™ ×œ×™×“×™×</button>
        </div>

        <div class="section" id="combined-section" style="display:none;">
            <h3>×§×•×‘×¥ db.json ××œ×</h3>
            <div class="data-box" id="combined-data"></div>
            <button onclick="copyCombined()">ğŸ“‹ ×”×¢×ª×§ ×”×›×œ</button>
            <button onclick="downloadJSON()">ğŸ’¾ ×”×•×¨×“ ×›×§×•×‘×¥ db.json</button>
        </div>

        <div class="success" id="success-msg"></div>
    </div>

    <script>
        let clientsData = [];
        let leadsData = [];

        function searchLocalStorage() {
            const resultDiv = document.getElementById('result');
            
            // Search for data in localStorage
            const keys = ['crm_clients_v3', 'crm_clients', 'crm_leads_v3', 'crm_leads'];
            let found = false;

            keys.forEach(key => {
                const data = localStorage.getItem(key);
                if (data) {
                    found = true;
                    try {
                        const parsed = JSON.parse(data);
                        if (key.includes('clients')) {
                            clientsData = parsed;
                            document.getElementById('clients-data').textContent = JSON.stringify(parsed, null, 2);
                            document.getElementById('clients-section').style.display = 'block';
                        } else if (key.includes('leads')) {
                            leadsData = parsed;
                            document.getElementById('leads-data').textContent = JSON.stringify(parsed, null, 2);
                            document.getElementById('leads-section').style.display = 'block';
                        }
                    } catch (e) {
                        console.error('Error parsing:', key, e);
                    }
                }
            });

            if (found) {
                // Create combined db.json format
                const dbJson = {
                    clients: clientsData,
                    leads: leadsData
                };
                document.getElementById('combined-data').textContent = JSON.stringify(dbJson, null, 2);
                document.getElementById('combined-section').style.display = 'block';
                
                resultDiv.innerHTML = `
                    <div class="success" style="display:block;">
                        âœ… × ××¦××• × ×ª×•× ×™×!<br>
                        - ${clientsData.length} ×”×›× ×¡×•×ª<br>
                        - ${leadsData.length} ×œ×™×“×™×
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="error">
                        âŒ ×œ× × ××¦××• × ×ª×•× ×™× ×‘×“×¤×“×¤×Ÿ ×”×–×”.<br>
                        × ×¡×” ×œ×¤×ª×•×— ××ª ×”×“×£ ×”×–×” ×‘×“×¤×“×¤×Ÿ ×©×‘×• ×”×©×ª××©×ª ×‘××¢×¨×›×ª.
                    </div>
                `;
            }
        }

        function copyClients() {
            const text = document.getElementById('clients-data').textContent;
            navigator.clipboard.writeText(text).then(() => {
                showSuccess('× ×ª×•× ×™ ×”×›× ×¡×•×ª ×”×•×¢×ª×§×•! âœ…');
            });
        }

        function copyLeads() {
            const text = document.getElementById('leads-data').textContent;
            navigator.clipboard.writeText(text).then(() => {
                showSuccess('× ×ª×•× ×™ ×œ×™×“×™× ×”×•×¢×ª×§×•! âœ…');
            });
        }

        function copyCombined() {
            const text = document.getElementById('combined-data').textContent;
            navigator.clipboard.writeText(text).then(() => {
                showSuccess('×”×›×œ ×”×•×¢×ª×§! ×¢×›×©×™×• ×”×“×‘×§ ××ª ×–×” ×‘×§×•×‘×¥ db.json âœ…');
            });
        }

        function downloadJSON() {
            const dbJson = {
                clients: clientsData,
                leads: leadsData
            };
            const dataStr = JSON.stringify(dbJson, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'db.json';
            link.click();
            showSuccess('×”×§×•×‘×¥ db.json ×”×•×¨×“! âœ…');
        }

        function showSuccess(msg) {
            const successDiv = document.getElementById('success-msg');
            successDiv.textContent = msg;
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>
