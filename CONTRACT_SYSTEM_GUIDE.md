# מדריך שימוש - מערכת יצירת חוזים אוטומטית

## סקירה כללית
המערכת מאפשרת יצירה אוטומטית של חוזים מתבניות Word, המרה ל-PDF, ושליחה דרך WhatsApp.

## הגדרה ראשונית

### 1. יצירת תבנית חוזה (Word)
1. צור קובץ Word (.docx) עם תבנית החוזה שלך
2. השתמש במשתנים הבאים בקובץ (הקפד על הסוגריים המסולסלים הכפולים):
   - `{{firstName}}` - שם פרטי
   - `{{lastName}}` - שם משפחה
   - `{{fullName}}` - שם מלא (פרטי + משפחה)
   - `{{phone}}` - מספר טלפון
   - `{{service}}` - סוג השירות
   - `{{eventDate}}` - תאריך האירוע
   - `{{location}}` - מיקום האירוע
   - `{{price}}` - מחיר כולל
   - `{{deposit}}` - מקדמה
   - `{{hasEscort}}` - האם יש ליווי (כן/לא)
   - `{{escortPrice}}` - מחיר ליווי
   - `{{hasBridesmaids}}` - האם יש מלוות (כן/לא)
   - `{{bridesmaidsCount}}` - מספר מלוות
   - `{{bridesmaidsPrice}}` - מחיר מלוות
   - `{{date}}` - תאריך יצירת החוזה

### 2. העלאת התבנית למערכת
1. היכנס ל"הגדרות הודעות" (⚙️ בתפריט העליון)
2. גלול לשלב "נשלח חוזה"
3. בסקציה "תבנית חוזה (Word)" לחץ על "Browse" והעלה את הקובץ
4. המערכת תציג אישור העלאה מצליחה ✅

## תהליך שליחת חוזה

### שלב א': העברת ליד לשלב "נשלח חוזה"
1. גרור את הליד לעמודה "נשלח חוזה"
2. יופיע פופאפ עם:
   - תצוגה מקדימה של ההודעה
   - שדות נוספים למילוי

### שלב ב': מילוי פרטים נוספים
השדות הבאים נדרשים ליצירת חוזה מלא:
- **שם משפחה** - אם לא מולא בעת יצירת הליד
- **יש ליווי?** - סמן אם יש צורך בשירות ליווי + מחיר
- **יש מלוות?** - סמן אם יש מלוות + כמות ומחיר

### שלב ג': תצוגה מקדימה (אופציונלי)
1. לחץ על "👁️ תצוגה מקדימה של החוזה"
2. המערכת תייצר את החוזה ותציג אותו ב-PDF
3. בדוק שכל הפרטים נכונים
4. לחץ "✓ אשר ושלח" או "חזור" לתיקונים

### שלב ד': שליחה
1. לחץ "✓ שלח עכשיו" (אם לא צפית בתצוגה מקדימה)
2. המערכת תייצר את החוזה, תמיר ל-PDF, ותפתח WhatsApp עם:
   - ההודעה שהוגדרה בהגדרות
   - קישור להורדת החוזה

## תכונות נוספות

### שמירת חוזים
- כל החוזים נשמרים בשרת בתיקיית `/contracts/`
- ניתן לגשת אליהם בכל עת דרך הקישור המצורף בהודעה
- החוזים נשמרים בפורמטים:
  - Word: `contract-{leadId}.docx`
  - PDF: `contract-{leadId}.pdf`

### היסטוריית שליחות
- כל שליחת חוזה נרשמת ב"היסטוריית הודעות" של הליד
- ניתן לצפות בהיסטוריה מתוך פרופיל הליד

### מניעת שגיאות
- אם לא הועלתה תבנית - המערכת תודיע על כך
- אם חסרים שדות חובה - המערכת תציג הודעת שגיאה
- אם יש בעיה ביצירת החוזה - ההודעה לא תישלח

## דוגמה לתבנית Word

```
חוזה מתן שירותי איפור

ביום {{date}} נכרת חוזה זה בין:

נותן השירות: איה מייקאפ
הלקוח: {{fullName}}
טלפון: {{phone}}

פרטי האירוע:
תאריך: {{eventDate}}
מיקום: {{location}}
שירות: {{service}}

פרטים כספיים:
מחיר כולל: {{price}} ₪
מקדמה: {{deposit}} ₪

שירותים נוספים:
ליווי: {{hasEscort}} - מחיר: {{escortPrice}} ₪
מלוות: {{hasBridesmaids}} - כמות: {{bridesmaidsCount}} - מחיר: {{bridesmaidsPrice}} ₪

חתימת הצדדים:
_______________     _______________
הלקוח                    נותן השירות
```

## טיפים

1. **תבדוק את התבנית** - לפני העלאה, ודא שכל המשתנים כתובים נכון
2. **שמור גיבויים** - שמור עותק של תבנית החוזה במחשב שלך
3. **תצוגה מקדימה** - השתמש בתצוגה מקדימה בפעם הראשונה לבדוק את התוצאה
4. **עדכן מחירים** - וודא שמחיר הליווי והמלוות מעודכנים לפני השליחה

## תמיכה טכנית
במקרה של בעיות:
1. בדוק שהתבנית הועלתה בהצלחה (ב"הגדרות הודעות")
2. בדוק שכל השדות מולאו בליד
3. נסה לצפות בתצוגה מקדימה לפני שליחה
4. בדוק את ה-console בדפדפן לשגיאות (F12)
